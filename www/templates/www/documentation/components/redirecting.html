{% extends "www/bases/documentation.html" %}

{% block subtitle %}Redirecting{% endblock subtitle %}

{% block content %}
<section class="content">
    <article class="section" id="main">
        <h1>
            Redirecting
        </h1>

        <p>
            <code>django-unicorn</code> has a few different ways to redirect from an action method.
        </p>

        <h2 id="redirect">Redirect</h2>

        <p>
             To redirect the user, return a <code>HttpResponseRedirect</code> from an action method. Using the Django shortcut <a href="https://docs.djangoproject.com/en/stable/topics/http/shortcuts/#redirect"><code>redirect</code></a> method is one  way to do that in a typical Django manner.
        </p>

        <p class="tip">
            <code>django.shortcuts.redirect</code> can take a Django model, Django view name, an absolute url, or a relative url. However, the <code>permanent</code> kwarg for <code>redirect</code> has no bearing in this context.
        </p>

        <p class="tip">
            It is not required to use <code>django.shortcuts.redirect</code>. Anything that returns a <code>HttpResponseRedirect</code> will behave the same in <code>django-unicorn</code>.
        </p>

        <pre data-lang="python"><code class="language-python"># redirect.py
from django.shortcuts import redirect
from django_unicorn.components import UnicornView
from .models import Book
    
class BookView(UnicornView):
    title = ""

    def save_book(self):
        book = Book(title=self.title)
        book.save()
        self.reset()
        
        return redirect(f"/book/{book.id}")</code></pre>

        <pre data-lang="html"><code class="language-html">&lt;!-- redirect.html -->
&lt;div>
    &lt;input unicorn:model="title" type="text" id="title">&lt;br />
    &lt;button unicorn:click="save_book()">Save book&lt;/button>
&lt;/div></code></pre>

        <h2 id="hash-update">HashUpdate</h2>

        <p>
            To avoid a server-side page refresh and just update the hash at the end of the url, return <code>HashUpdate</code> from the action method.
        </p>

        <pre data-lang="python"><code class="language-python"># hash_update.py
from django_unicorn.components import HashUpdate, UnicornView
from .models import Book
    
class BookView(UnicornView):
    title = ""

    def save_book(self):
        book = Book(title=self.title)
        book.save()
        self.reset()
        
        return HashUpdate(f"#{book.id}")</code></pre>

        <pre data-lang="html"><code class="language-html">&lt;!-- hash-update.html -->
&lt;div>
    &lt;input unicorn:model="title" type="text" id="title">&lt;br />
    &lt;button unicorn:click="save_book()">Save book&lt;/button>
&lt;/div></code></pre>

        <h2 id="location-update">LocationUpdate</h2>

        <p>
            To avoid a server-side page refresh and update the whole url, return a <code>LocationUpdate</code> from the action method.
        </p>

        <p>
            <code>LocationUpdate</code> is instantiated with a <code>HttpResponseRedirect</code> arg and an optional <code>title</code> kwarg.
        </p>

        <p class="tip">
            <code>LocationUpdate</code> uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/History/pushState"><code>window.history.pushState</code></a> so the new url must be relative or the same origin as the original url.
        </p>

        <pre data-lang="python"><code class="language-python"># location_update.py
from django.shortcuts import redirect
from django_unicorn.components import LocationUpdate, UnicornView
from .models import Book
    
class BookView(UnicornView):
    title = ""

    def save_book(self):
        book = Book(title=self.title)
        book.save()
        self.reset()
        
        return LocationUpdate(redirect(f"/book/{book.id}"), title=f"{book.title}")</code></pre>

        <pre data-lang="html"><code class="language-html">&lt;!-- location-update.html -->
&lt;div>
    &lt;input unicorn:model="title" type="text" id="title">&lt;br />
    &lt;button unicorn:click="save_book()">Save book&lt;/button>
&lt;/div></code></pre>

        <div class="previous">
            <a href="{% url 'www:documentation' name='components/validation' %}">Validation</a>
        </div>

        <div class="next">
            <a href="{% url 'www:documentation' name='components/loading-states' %}">Loading States</a>
        </div>
    </article>
</section>

{% endblock content %}
