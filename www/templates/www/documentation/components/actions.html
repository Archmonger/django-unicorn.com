{% extends "www/bases/documentation.html" %}

{% block subtitle %}Actions{% endblock subtitle %}

{% block content %}
<section class="content">
    <article class="section" id="main">
        <h1>
            Actions
        </h1>

        <p>
            Components can also trigger methods from the templates by listening to any valid event type. The most common events would be <code>click</code>, <code>input</code>, <code>keydown</code>, <code>keyup</code>, and <code>mouseenter</code>, but <a href="https://developer.mozilla.org/en-US/docs/Web/Events">MDN has a list of all of the browser event types available</a>.
        </p>

        <h2 id="events">Events</h2>

        <p>
            An example action to call the <code>clear_name</code> method on the component.
        </p>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- clear-name.html -->
&lt;div>
    &lt;input unicorn:model="name" type="text" id="text">
    Hello {{ name|title }}
    &lt;button unicorn:click="clear_name">Clear Name&lt;/button>
&lt;/div></code></pre>
        {% endverbatim %}

        <pre data-lang="python"><code class="language-python"># clear_name.py
from django_unicorn.components import UnicornView

class ClearNameView(UnicornView):
    name = "World"

    def clear_name(self):
        self.name = ""</code></pre>
    
        <p>
            When the button is clicked, the <code>name</code> property will get set to an empty string. Then, the component will intelligently re-render itself and the text input will update to match the property on the component.
        </p>

        <p class="tip">
            Instance methods without arguments can be called from the template with or without parenthesis.
        </p>

        <h2 id="passing-arguments">Passing arguments</h2>
        <p>
            Actions can also pass basic types of arguments to the backend component.
        </p>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- passing-args.html -->
&lt;div>
    &lt;input unicorn:model="name" type="text" id="text">
    Hello {{ name|title }} ðŸ‘‹
    &lt;button unicorn:click="set('Bob')">Set as Bob&lt;/button>
    &lt;button unicorn:click="set()">Set default value of name argument&lt;/button>
&lt;/div></code></pre>
        {% endverbatim %}

        <pre data-lang="python"><code class="language-python"># passing_args.py
from django_unicorn.components import UnicornView

class PassingArgsView(UnicornView):
    name = "World"

    def set(self, name="Universe"):
        self.name = name</code></pre>

        <h3 id="argument-types">Argument types</h3>
        <p>
            Arguments can be most basic Python types, including <code>string</code>, <code>int</code>, <code>float</code>, <code>list</code>, <code>tuple</code>, <code>dictionary</code>, <code>set</code>, <code>datetime</code>, and <code>UUID4</code>.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- argument-types.html -->
&lt;div>
    &lt;button unicorn:click="update(99)">Pass int&lt;/button>
    &lt;button unicorn:click="update(1.234)">Pass float&lt;/button>
    &lt;button unicorn:click="update({'key': 'value'})">Pass dictionary&lt;/button>
    &lt;button unicorn:click="update([1, 2, 3])">Pass list&lt;/button>
    &lt;button unicorn:click="update((1, 2, 3))">Pass tuple&lt;/button>
    &lt;button unicorn:click="update({1, 2, 3})">Pass set&lt;/button>
    &lt;button unicorn:click="update(2020-09-12T01:01:01)">Pass datetime&lt;/button>
    &lt;button unicorn:click="update(90144cb9-fc47-476d-b124-d543b0cff091)">Pass UUID&lt;/button>
&lt;/div></code></pre>

        <p class="tip">
            Strings will be converted to <code>datetime</code> if they are successfully parsed by Django's <code><a href="https://docs.djangoproject.com/en/stable/ref/utils/#django.utils.dateparse.parse_datetime">parse_datetime</a></code> method.
        </p>

        <h2 id="set">Set shortcut</h2>
        <p>
            Actions can also set properties without requiring an explicit method.
        </p>

        {% verbatim %}<pre data-lang="html"><code class="language-html">&lt;!-- set-shortcut.html -->
&lt;div>
    &lt;input unicorn:model="name" type="text" id="text">
    Hello {{ name|title }} ðŸ‘‹
    &lt;button unicorn:click="name='Bob'">Set name as Bob&lt;/button>
&lt;/div></code></pre>{% endverbatim %}

        <pre data-lang="python"><code class="language-python"># set_shortcut.py
from django_unicorn.components import UnicornView

class SetShortcutView(UnicornView):
    name = "World"</code></pre>

        <h2 id="modifiers">Modifiers</h2>
        <p>
            Similar to models, actions also have modifiers which change how the method gets called.
        </p>

        <h3 id="prevent">prevent</h3>
        <p>
            Prevents the default action the browser would use for that element. The same as calling <code>preventDefault</code>.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- prevent-modifier.html -->
&lt;div>
    &lt;button unicorn:click.prevent="name='Bob'">Set name as Bob&lt;/button>
&lt;/div></code></pre>

        <h3 id="stop">stop</h3>
        <p>
            Stops the event from bubbling up the event chain. The same as calling <code>stopPropagation</code>.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- stop-modifier.html -->
&lt;div>
    &lt;button unicorn:click.stop="name='Bob'">Set name as Bob&lt;/button>
&lt;/div></code></pre>

        <h2 id="special-arguments">Special arguments</h2>

        <h3 id="event">$event</h3>
        <p>
            A reference to the event that triggered the action.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- event.html -->
&lt;div>
    &lt;input type="text" unicorn:change="update($event.target.value.trim())">Update&lt;/input>
&lt;/div></code></pre>

        <h3 id="model">$model</h3>
        <p>
            Sends the current <code>db_model</code> to an action.
        </p>

        <p class="tip">
            <code>$model</code> requires <code><a href="{% url 'www:documentation' name='components/django-models' %}#db-model">db_models</a></code> to be defined in the component's <code>Meta</code> class. The component method must also be decorated with <code>django_unicorn.decorators.db_model</code> and must have at least one argument (which will be converted into the specified Django model from the frontend).
        </p>

        <pre data-lang="python"><code class="language-python"># model.py
from django_unicorn.components import UnicornView
from django_unicorn.db import DbModel
from django_unicorn.decorators import db_model
from .models import Book

class ModelView(UnicornView):
    books = Book.models.all()

    @db_model
    def delete(self, book):
        book.delete()

    class Meta:
        db_models = [DbModel("book", Book)]</code></pre>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- model.html -->
&lt;div>
    &lt;div unicorn:db="book">
        {% for book in books %}
        &lt;div unicorn:pk="{{ book.pk }}">
            &lt;input type="text" unicorn:change="delete($model)">Delete the current book&lt;/input>
        &lt;/div>
        {% endfor %}
    &lt;/div>
&lt;/div></code></pre>
        {% endverbatim %}

        <h2 id="special-methods">Special methods</h2>

        <h3 id="refresh">$refresh</h3>
        <p>
            Refresh and re-render the component from its current state.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- refresh-method.html -->
&lt;div>
    &lt;button unicorn:click="$refresh">Refresh the component&lt;/button>
&lt;/div></code></pre>

        <h3 id="reset">$reset</h3>
        <p>
            Revert the component to its original state.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- reset-method.html -->
&lt;div>
    &lt;button unicorn:click="$reset">Reset the component&lt;/button>
&lt;/div></code></pre>

        <h3 id="toggle">$toggle</h3>
        <p>
            Toggle a field on the component. Can only be used for fields that are booleans.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- toggle-method.html -->
&lt;div>
    &lt;button unicorn:click="$toggle('check')">Toggle the check field&lt;/button>
&lt;/div></code></pre>

        <p class="tip">
            Multiple fields can be toggled at the same time by passing in multiple fields at a time: <code>unicorn:click="$toggle('check', 'another_check', 'a_third_check')"</code>. Nested properties are also supported: <code>unicorn:click="$toggle('nested.check')"</code>.
        </p>

        <h3 id="validate">$validate</h3>
        <p>
            Validate the component.
        </p>

        <pre data-lang="html"><code class="language-html">&lt;!-- validate-method.html -->
&lt;div>
    &lt;button unicorn:click="$validate">Validate the component&lt;/button>
&lt;/div></code></pre>

        <h2 id="calling-methods">Calling methods</h2>

        <p>
            Sometimes you need to trigger a method on a component from regular Javascript. That is possible with <code>Unicorn.call()</code>. It can be called from anywhere on the page.
        </p>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- index.html -->
{% unicorn 'hello-world' %}
        
&lt;button onclick="Unicorn.call('hello-world', 'set_name');">Set the name from outside the component&lt;/button></code></pre>
        {% endverbatim %}

        <div class="previous">
            <a href="{% url 'www:documentation' name='components/django-models' %}">Django models</a>
        </div>

        <div class="next">
            <a href="{% url 'www:documentation' name='components/validation' %}">Validation</a>
        </div>
    </article>
</section>

{% endblock content %}
