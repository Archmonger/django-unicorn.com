{% extends "www/bases/documentation.html" %}

{% block subtitle %}Django Models{% endblock subtitle %}

{% block content %}
<section class="content">
    <article class="section" id="main">
        <h1>
            Django models
        </h1>

        <p>
            <code>django-unicorn</code> provides tight integration with Django <code>Models</code> and <code>Querysets</code> to handle typical Django workflows. There are multiple ways to integrate a Django model with a component. They all work a little differently and which option you choose to do depends on the situation.
        </p>


        <h2 id="class-model">Class Model</h2>
        <p>
            Django models can be initialized similar to how basic Python objects (i.e. strings, integers, dictionaries) can be set on a component.
        </p>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- class-attribute.html -->
&lt;div>
    &lt;input unicorn:model.defer="book.title" type="text" id="book">
    {{ book.title }}
    &lt;button unicorn:click="save">Save&lt;/button>
&lt;/div></code></pre>
        {% endverbatim %}

        <pre data-lang="python"><code class="language-python"># class_attribute.py
from django_unicorn.components import UnicornView
from books.models import Book

class ClassAttributeView(UnicornView):
    book = Book()

    def save(self):
        self.book.save()</code></pre>


        <h2 id="instance-model">Instance Model</h2>
        <p>
            Django models can be initialized in the component's <code>__init__</code> method similar to how a "normal" class would initialize an instance variable.
        </p>

        <p class="tip">
            <code>super().__init__(**kwargs)</code> <strong>has</strong> to be called at the end of the overriden <code>__init__</code> method.
        </p>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- instance-attribute.html -->
&lt;div>
    &lt;input unicorn:model.defer="book.title" type="text" id="book">
    {{ book.title }}
    &lt;button unicorn:click="save">Save&lt;/button>
&lt;/div></code></pre>
        {% endverbatim %}

        <pre data-lang="python"><code class="language-python"># instance_attribute.py
from django_unicorn.components import UnicornView
from books.models import Book

class InstanceAttributeView(UnicornView):
    def __init__(self, **kwargs):
        self.book = Book()

        # super() has to be called at the end
        super().__init__(**kwargs)

    def save(self):
        self.book.save()</code></pre>


        <h2 id="db-model">DbModel</h2>
        <p>
            If there is no reason to have a class or instance attribute, then <code>django-unicorn</code> also provides a <code>DbModel</code> class that ties a simple name used in the front-end to a Django model defined in the component.
        </p>

        <p><code>DbModel</code> can also live in a parent element and surround a group of inputs. The <code>unicorn:field</code> attribute is used for Django's model fields.

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- db-model.html -->
&lt;div>
    &lt;div unicorn:db="book">
        &lt;div>
            &lt;input unicorn:field.defer="title" type="text" id="title">
            {{ book.title }}
        &lt;/div>
        &lt;div>
            &lt;input unicorn:field.defer="description" type="text" id="description" />
            {{ book.description }}
        &lt;/div>
    &lt;/div>
    
    &lt;button unicorn:click="save">Save&lt;/button>
&lt;/div></code></pre>
        {% endverbatim %}

        <pre data-lang="python"><code class="language-python"># db_model.py
from django_unicorn.components import UnicornView
from books.models import Book

class DbModelView(UnicornView):
    class Meta:
        db_models = [DbModel("book", Book)]

    def save(self):
        pass</code></pre>


        <h2 id="queryset">Queryset</h2>
        <p>
            Binding models to a Django <code>Queryset</code> is done by setting an <code>unicorn:pk</code> attribute with the <code>model</code>'s <code>pk</code> (normally an integer in an <code>id</code> field, but could be a custom <a href="https://docs.djangoproject.com/en/stable/ref/models/fields/#django.db.models.Field.primary_key"><code>primary_key</code></a>).
        </p>

        <p class="tip">
            A blank value for an <code>unicorn:pk</code> attribute signals to <code>django-unicorn</code> to create a new instance of the underlying Django <code>model</code> of the queryset.
        </p>

        {% verbatim %}
        <pre data-lang="html"><code class="language-html">&lt;!-- queryset.html -->
&lt;div>
    &lt;div unicorn:model="books">
        &lt;div unicorn:pk="">&lt;!-- A blank pk will create a new model when it is saved -->
            &lt;div>
                &lt;input unicorn:field.defer="title" type="text" id="title">
            &lt;/div>
            &lt;div>
                &lt;input unicorn:field.defer="description" type="text" id="description" />
            &lt;/div>
        &lt;/div>

        {% for book in books %}
        &lt;div unicorn:pk="{{ book.pk }}">&lt;!-- Using the model's pk will save the model -->
            &lt;div>
                &lt;input unicorn:field.defer="title" type="text" id="title">
                {{ book.title }}
            &lt;/div>
            &lt;div>
                &lt;input unicorn:field.defer="description" type="text" id="description" />
                {{ book.description }}
            &lt;/div>
        &lt;/div>
        {% endfor %}
    &lt;/div>
    
    &lt;button unicorn:click="save">Save&lt;/button>
&lt;/div></code></pre>
        {% endverbatim %}

        <pre data-lang="python"><code class="language-python"># queryset.py
from django_unicorn.components import UnicornView
from books.models import Book

class QuerysetView(UnicornView):
    books = Book.objects.none()

    def hydrate(self):
        # Using `hydrate` is the best way to make sure that QuerySets
        # are re-queried every time the component is loaded
        self.books = Book.objects.all().order_by("-id")[:5]

    def save(self):
        pass</code></pre>

        <div class="previous">
            <a href="{% url 'www:documentation' name='components/templates' %}">Templates</a>
        </div>

        <div class="next">
            <a href="{% url 'www:documentation' name='components/actions' %}">Actions</a>
        </div>
    </article>
</section>

{% endblock content %}
